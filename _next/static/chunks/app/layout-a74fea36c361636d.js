(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{8159:function(e,t,r){Promise.resolve().then(r.bind(r,7219)),Promise.resolve().then(r.bind(r,2948)),Promise.resolve().then(r.t.bind(r,4121,23)),Promise.resolve().then(r.t.bind(r,6408,23)),Promise.resolve().then(r.t.bind(r,962,23)),Promise.resolve().then(r.t.bind(r,6297,23))},6653:function(e,t,r){"use strict";r.d(t,{L:function(){return o},c:function(){return s}});var n=r(5474),a=r(666);function o(){return localStorage.getItem(a.px)}async function i(){return await (0,n.gw)(2e3),{code:a.mI,message:"Mock",data:{nickName:"Mock",token:"Mock"}}}async function s(e,t){if(a.M7)return await i();let r=await fetch("".concat(a.FH,"/member/login"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:e,password:t})});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));return await r.json()}},2948:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return E}});var n=r(9268),a=r(6006),o=r(984),i=r.n(o),s=r(5846),c=r.n(s),u=r(6008),l=r(9279),d=r.n(l),m=r(8683),f=r.n(m),g=r(7613),p=r.n(g);let h=[{href:"/member",title:"會員管理"},{href:"/restoration",title:"古蹟修復管理"},{href:"/landmark",title:"古蹟列表管理"},{href:"/store",title:"商家資訊管理"}],v=(0,a.memo)(e=>{let{href:t,children:r}=e,a=(0,u.usePathname)();return(0,n.jsx)(c(),{className:f()({[d().activate]:"".concat(p().basePath?p().basePath:"").concat(t)===a}),href:t,children:r})});v.displayName="NavItem";let x=(0,a.memo)(()=>(0,n.jsx)("div",{className:d().wrapper,children:h.map(e=>{let{href:t,title:r}=e;return(0,n.jsx)(v,{href:t,children:r},t)})}));x.displayName="Nav";var y=r(6624),b=r(6831),M=r(4161),k=r(7454),w=r(9153);let j=(0,a.memo)(()=>{let{authConfig:{loginState:e,username:t},logout:r}=(0,a.useContext)(y.V);return(0,n.jsxs)("div",{className:f()(i().wrapper,"z-[1000]"),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(k.Z,{src:"/images/logo.jpg",width:50,height:50,alt:"潮古蹟標誌"}),(0,n.jsx)("h3",{children:"潮古蹟"}),(0,n.jsx)(x,{})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:t}),(0,n.jsx)(b.Z,{loading:e===M.M.loggingOut,onClick:r,looks:w.L.dark,children:"登出"})]})]})});j.displayName="Navbar";var N=r(2082),_=r.n(N);let S=(0,a.memo)(e=>{let{children:t}=e,{authConfig:{loginState:r}}=(0,a.useContext)(y.V);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j,{}),(0,n.jsx)("div",{className:_().wrapper,children:(r===M.M.true||r===M.M.loggingOut)&&t})]})});S.displayName="AdminLayout";var E=S},7219:function(e,t,r){"use strict";r.r(t);var n=r(9268),a=r(3099),o=r(3368),i=r(6624),s=r(4161),c=r(6006);let u=(0,c.memo)(e=>{let{loginPage:t,adminPage:r}=e,{authConfig:{loginState:u}}=(0,c.useContext)(i.V);switch(u){case s.M.none:return(0,n.jsx)(a.Z,{children:(0,n.jsx)(o.Z,{})});case s.M.validating:return(0,n.jsx)(o.Z,{expand:!0,children:r});case s.M.true:case s.M.validateError:case s.M.loggingOut:return r;case s.M.false:return t}});u.displayName="AuthRoute";let l=(0,c.memo)(e=>{let{loginPage:t,adminPage:r}=e;return(0,n.jsx)(i.H,{children:(0,n.jsx)(u,{loginPage:t,adminPage:r})})});l.displayName="AuthRouteWrapper",t.default=l},7454:function(e,t,r){"use strict";var n=r(9268),a=r(6394),o=r.n(a),i=r(6006),s=r(7613),c=r.n(s);let u=(0,i.memo)((0,i.forwardRef)((e,t)=>{let{src:r,...a}=e;return(0,n.jsx)(o(),{...a,ref:t,unoptimized:!0,src:"string"==typeof r&&r.startsWith("/")&&c().basePath?"".concat(c().basePath).concat(r):r})}));u.displayName="CustomImage",t.Z=u},6831:function(e,t,r){"use strict";var n=r(9268),a=r(6006),o=r(3368),i=r(1576),s=r.n(i),c=r(8683),u=r.n(c),l=r(9153);let d=(0,a.memo)(e=>{let{className:t,children:r,type:a,loading:i,disabled:c,onClick:d,looks:m,icon:f,...g}=e;return(0,n.jsxs)("button",{...g,className:"close"===f?u()("h-8 w-8 bg-close bg-4 bg-center bg-no-repeat opacity-50 hover:opacity-75",t):u()("rounded px-3 py-1.5",{[s().primary]:!m||m===l.L.primary,"bg-gray-100":m===l.L.secondary,[s().danger]:m===l.L.danger,[s().dark]:m===l.L.dark,"bg-green-700 text-white":m===l.L.green},t),disabled:i||c,onClick:d,type:a,children:[i&&(0,n.jsx)(o.Z,{size:o.v.small})," ",r]})});d.displayName="Button",t.Z=d},3099:function(e,t,r){"use strict";var n=r(9268),a=r(6006),o=r(8414),i=r.n(o);let s=(0,a.memo)(e=>{let{children:t}=e;return(0,n.jsx)("div",{className:i().center,children:(0,n.jsx)("div",{children:t})})});s.displayName="Center",t.Z=s},3368:function(e,t,r){"use strict";r.d(t,{v:function(){return a}});var n,a,o=r(9268),i=r(6006),s=r(8683),c=r.n(s);(n=a||(a={})).small="small",n.medium="medium";let u=(0,i.memo)(e=>{let{spinning:t=!0,size:r=a.medium,expand:n=!1,children:i}=e;return(0,o.jsxs)("div",{className:c()("relative inline-block",{"h-full w-full":n}),children:[i,t&&(0,o.jsx)("div",{className:c()("inset-0 flex items-center justify-center",{"absolute bg-white opacity-70":i,"static bg-transparent":!i}),children:(0,o.jsx)("div",{className:c()("animate-spin rounded-full border-solid border-slate-100 border-t-blue-500",{"h-2.5 w-2.5 border-2":r===a.small,"h-10 w-10 border-4":r===a.medium})})})]})});u.displayName="Spin",t.Z=u},158:function(e,t,r){"use strict";var n=r(9268),a=r(6006),o=r(6292),i=r(8683),s=r.n(i);let c=(0,a.memo)(e=>{let{children:t,icon:r,removeModal:o}=e,[i,c]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{let e=setTimeout(()=>{c(!1),e=setTimeout(()=>{o()},300)},3e3);return()=>{clearTimeout(e)}},[o]),(0,n.jsxs)("div",{className:s()("my-2 rounded bg-white px-4 py-2 shadow",{"animate-fade-in":i,"animate-fade-out":!i}),children:[r," ",t]})});function u(e,t){let r=(0,o.E)("toastContainer","fixed left-1/2 top-0 z-[2000] -translate-x-1/2 transform"),{render:a,removeModal:i}=(0,o.k)(r);a((0,n.jsx)(c,{icon:t,removeModal:i,children:e}))}c.displayName="Toast",t.Z={success:e=>{u(e,"success:")},error:e=>{u(e,"error:")}}},6292:function(e,t,r){"use strict";r.d(t,{E:function(){return a},k:function(){return o}});var n=r(3194);function a(e,t){let r=document.getElementById(e);return r||((r=document.createElement("div")).id=e,t&&(r.className=t),document.body.appendChild(r)),r}function o(e){let t=document.createElement("div");e.appendChild(t);let r=(0,n.createRoot)(t);return{render:e=>{r.render(e)},removeModal:()=>{r.unmount(),null==e||e.removeChild(t)}}}},6624:function(e,t,r){"use strict";r.d(t,{H:function(){return p},V:function(){return g}});var n=r(9268),a=r(6653),o=r(158),i=r(4161),s=r(2624),c=r(5474),u=r(666),l=r(6006);let d="loginState",m="username",f=()=>{let e=localStorage.getItem(d)||"",t=localStorage.getItem(m)||"",r=localStorage.getItem(u.px)||"";return e in i.M?{loginState:e,username:t,token:r}:{loginState:i.M.none,username:"",token:""}},g=(0,l.createContext)({authConfig:{loginState:i.M.none,username:"",token:""},login:async()=>{throw Error("AuthProvider not found")},logout:async()=>{throw Error("AuthProvider not found")}}),p=(0,l.memo)(e=>{let{children:t}=e,[r,p]=(0,l.useState)({loginState:i.M.none,username:"",token:""}),h=(0,l.useRef)(r);h.current=r;let v=(0,l.useCallback)(e=>{let{loginState:t,username:r,token:n}=e;p({loginState:t,username:r,token:n}),localStorage.setItem(d,t),localStorage.setItem(m,r),localStorage.setItem(u.px,n)},[]),x=(0,l.useCallback)(async function(e,t){let{logType:r=s.L.none}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(h.current.loginState===i.M.none)throw Error("Project starting");if(h.current.loginState===i.M.true||h.current.loginState===i.M.validating||h.current.loginState===i.M.validateError)throw Error("Already login");try{let n=await (0,a.c)(e,t);if((null==n?void 0:n.code)!==u.mI)return o.Z.error(null==n?void 0:n.message),!1;return o.Z.success("成功"),v({loginState:i.M.true,username:n.data.nickName,token:n.data.token}),(0,c.cM)("log in success",r),!0}catch(e){return e instanceof Error?(0,c.cM)(e.message,r):(0,c.cM)(e,r),!1}},[v]),y=(0,l.useCallback)(async()=>(v({loginState:i.M.loggingOut,username:h.current.username,token:h.current.token}),await (0,c.gw)(1e3),v({loginState:i.M.false,username:"",token:""}),!0),[v]),b=(0,l.useMemo)(()=>({authConfig:r,login:x,logout:y}),[r,x,y]);return(0,l.useEffect)(()=>{let e=async()=>{let{loginState:e,username:t,token:r}=f();if(e===i.M.true||e===i.M.validateError){v({loginState:i.M.validating,username:t,token:r});try{v({loginState:i.M.true,username:t,token:r})}catch(e){e instanceof Error?(0,c.cM)(e.message,s.L.message):(0,c.cM)(e,s.L.message),v({loginState:i.M.validateError,username:t,token:r})}}else v({loginState:i.M.false,username:"",token:""})};e()},[v]),(0,n.jsx)(g.Provider,{value:b,children:t})});p.displayName="AuthProvider"},7613:function(e){"use strict";e.exports={output:"export",basePath:"/historic-site-portal-demo-test"}},4161:function(e,t,r){"use strict";var n,a;r.d(t,{M:function(){return n}}),(a=n||(n={})).none="none",a.validating="validating",a.validateError="validateError",a.true="true",a.false="false",a.loggingOut="loggingOut"},2624:function(e,t,r){"use strict";var n,a;r.d(t,{L:function(){return n}}),(a=n||(n={})).none="none",a.console="console",a.message="message"},9153:function(e,t,r){"use strict";var n,a;r.d(t,{L:function(){return n}}),(a=n||(n={})).primary="primary",a.secondary="secondary",a.dark="dark",a.danger="danger",a.green="green"},666:function(e,t,r){"use strict";r.d(t,{FH:function(){return n},M7:function(){return o},mI:function(){return i},px:function(){return a}});let n="https://historical-site-backend-18d1df54380f.herokuapp.com",a="token",o=!1,i="S001"},5474:function(e,t,r){"use strict";r.d(t,{cM:function(){return s},gw:function(){return i},o2:function(){return l},rn:function(){return c},sG:function(){return u}});var n=r(2624),a=r(5326),o=r.n(a);let i=async e=>{await new Promise(t=>setTimeout(t,e))},s=(e,t)=>{switch(t){case n.L.none:break;case n.L.console:case n.L.message:console.log(e)}};function c(e){return e?o()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}let u=(async()=>{}).constructor;function l(e){return Object.fromEntries(Object.entries(e).filter(e=>{let[,t]=e;return void 0!==t}))}},4121:function(){},6408:function(){},2082:function(e){e.exports={wrapper:"AdminLayout_wrapper__1qyET"}},9279:function(e){e.exports={wrapper:"Nav_wrapper__inB0k",activate:"Nav_activate__8tx0l"}},984:function(e){e.exports={wrapper:"Header_wrapper___4abJ"}},6297:function(e){e.exports={wrapper:"Root_wrapper__oqOcq"}},1576:function(e){e.exports={primary:"Button_primary__Nhi6i",danger:"Button_danger__214td",dark:"Button_dark__Djc0e"}},8414:function(e){e.exports={center:"Center_center__ucmSV"}}},function(e){e.O(0,[550,720,56,253,488,744],function(){return e(e.s=8159)}),_N_E=e.O()}]);