(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{4338:function(e,t,r){Promise.resolve().then(r.bind(r,7219)),Promise.resolve().then(r.bind(r,2948)),Promise.resolve().then(r.t.bind(r,6408,23)),Promise.resolve().then(r.t.bind(r,4121,23)),Promise.resolve().then(r.t.bind(r,962,23)),Promise.resolve().then(r.t.bind(r,6297,23))},6653:function(e,t,r){"use strict";r.d(t,{L:function(){return o},c:function(){return s}});var n=r(5474),a=r(666);function o(){return localStorage.getItem(a.px)}async function i(){return await (0,n.gw)(2e3),{code:a.mI,message:"Mock",data:{nickName:"Mock",token:"Mock"}}}async function s(e,t){if(a.M7)return await i();let r=await fetch("".concat(a.FH,"/member/login"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:e,password:t})});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));return await r.json()}},2948:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return P}});var n=r(9268),a=r(6006),o=r(984),i=r.n(o),s=r(5846),c=r.n(s),l=r(6008),u=r(9279),d=r.n(u),m=r(8683),g=r.n(m),f=r(7613),h=r.n(f);let p=[{href:"/member",title:"會員管理"},{href:"/restoration",title:"古蹟修復管理"},{href:"/landmark",title:"古蹟列表管理"},{href:"/store",title:"商家資訊管理"}],v=(0,a.memo)(e=>{let{href:t,children:r}=e,a=(0,l.usePathname)();return(0,n.jsx)(c(),{className:g()({[d().activate]:"".concat(h().basePath?h().basePath:"").concat(t)===a}),href:t,children:r})});v.displayName="NavItem";let x=(0,a.memo)(()=>(0,n.jsx)("div",{className:d().wrapper,children:p.map(e=>{let{href:t,title:r}=e;return(0,n.jsx)(v,{href:t,children:r},t)})}));x.displayName="Nav";var y=r(6624),M=r(6831),b=r(4161),k=r(7454),w=r(9153);let j=(0,a.memo)(()=>{let{authConfig:{loginState:e,username:t},logout:r}=(0,a.useContext)(y.V);return(0,n.jsxs)("div",{className:g()(i().wrapper,"z-[1000]"),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(k.Z,{src:"/images/logo.jpg",width:50,height:50,alt:"潮古蹟標誌"}),(0,n.jsx)("h3",{children:"潮古蹟"}),(0,n.jsx)(x,{})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:t}),(0,n.jsx)(M.Z,{loading:e===b.M.loggingOut,onClick:r,looks:w.L.dark,children:"登出"})]})]})});j.displayName="Navbar";var _=r(2082),N=r.n(_);let S=(0,a.memo)(e=>{let{children:t}=e,{authConfig:{loginState:r}}=(0,a.useContext)(y.V);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j,{}),(0,n.jsx)("div",{className:N().wrapper,children:(r===b.M.true||r===b.M.loggingOut)&&t})]})});S.displayName="AdminLayout";var P=S},7219:function(e,t,r){"use strict";r.r(t);var n=r(9268),a=r(3099),o=r(3368),i=r(6624),s=r(4161),c=r(6006);let l=(0,c.memo)(e=>{let{loginPage:t,adminPage:r}=e,{authConfig:{loginState:l}}=(0,c.useContext)(i.V);switch(l){case s.M.none:return(0,n.jsx)(a.Z,{children:(0,n.jsx)(o.Z,{})});case s.M.validating:return(0,n.jsx)(o.Z,{expand:!0,children:r});case s.M.true:case s.M.validateError:case s.M.loggingOut:return r;case s.M.false:return t}});l.displayName="AuthRoute";let u=(0,c.memo)(e=>{let{loginPage:t,adminPage:r}=e;return(0,n.jsx)(i.H,{children:(0,n.jsx)(l,{loginPage:t,adminPage:r})})});u.displayName="AuthRouteWrapper",t.default=u},7454:function(e,t,r){"use strict";var n=r(9268),a=r(6394),o=r.n(a),i=r(6006),s=r(7613),c=r.n(s);let l=(0,i.memo)((0,i.forwardRef)((e,t)=>{let{src:r,...a}=e;return(0,n.jsx)(o(),{...a,ref:t,unoptimized:!0,src:"string"==typeof r&&r.startsWith("/")&&c().basePath?"".concat(c().basePath).concat(r):r})}));l.displayName="CustomImage",t.Z=l},6831:function(e,t,r){"use strict";var n=r(9268),a=r(6006),o=r(3368),i=r(1576),s=r.n(i),c=r(8683),l=r.n(c),u=r(9153);let d=(0,a.memo)(e=>{let{className:t,children:r,loading:a,disabled:i,htmlType:c,onClick:d,looks:m,icon:g}=e;return(0,n.jsxs)("button",{className:"close"===g?l()("h-8 w-8 bg-close bg-4 bg-center bg-no-repeat opacity-50 hover:opacity-75",t):l()("rounded px-3 py-1.5",{[s().primary]:!m||m===u.L.primary,[s().danger]:m===u.L.danger,[s().dark]:m===u.L.dark,"bg-green-700 text-white":m===u.L.green},t),disabled:a||i,onClick:d,type:c,children:[a&&(0,n.jsx)(o.Z,{size:o.v.small})," ",r]})});d.displayName="Button",t.Z=d},3099:function(e,t,r){"use strict";var n=r(9268),a=r(6006),o=r(8414),i=r.n(o);let s=(0,a.memo)(e=>{let{children:t}=e;return(0,n.jsx)("div",{className:i().center,children:(0,n.jsx)("div",{children:t})})});s.displayName="Center",t.Z=s},3368:function(e,t,r){"use strict";r.d(t,{v:function(){return a}});var n,a,o=r(9268),i=r(6006),s=r(8683),c=r.n(s);(n=a||(a={})).small="small",n.medium="medium";let l=(0,i.memo)(e=>{let{spinning:t=!0,size:r=a.medium,expand:n=!1,children:i}=e;return(0,o.jsxs)("div",{className:c()("relative inline-block",{"h-full w-full":n}),children:[i,t&&(0,o.jsx)("div",{className:c()("inset-0 flex items-center justify-center",{"absolute bg-white opacity-70":i,"static bg-transparent":!i}),children:(0,o.jsx)("div",{className:c()("animate-spin rounded-full border-solid border-slate-100 border-t-blue-500",{"h-2.5 w-2.5 border-2":r===a.small,"h-10 w-10 border-4":r===a.medium})})})]})});l.displayName="Spin",t.Z=l},6624:function(e,t,r){"use strict";r.d(t,{H:function(){return f},V:function(){return g}});var n=r(9268),a=r(6653),o=r(4161),i=r(2624),s=r(5474),c=r(666),l=r(6006);let u="loginState",d="username",m=()=>{let e=localStorage.getItem(u)||"",t=localStorage.getItem(d)||"",r=localStorage.getItem(c.px)||"";return e in o.M?{loginState:e,username:t,token:r}:{loginState:o.M.none,username:"",token:""}},g=(0,l.createContext)({authConfig:{loginState:o.M.none,username:"",token:""},login:async()=>{throw Error("AuthProvider not found")},logout:async()=>{throw Error("AuthProvider not found")}}),f=(0,l.memo)(e=>{let{children:t}=e,[r,f]=(0,l.useState)({loginState:o.M.none,username:"",token:""}),h=(0,l.useRef)(r);h.current=r;let p=(0,l.useCallback)(e=>{let{loginState:t,username:r,token:n}=e;f({loginState:t,username:r,token:n}),localStorage.setItem(u,t),localStorage.setItem(d,r),localStorage.setItem(c.px,n)},[]),v=(0,l.useCallback)(async function(e,t){let{logType:r=i.L.none}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(h.current.loginState===o.M.none)throw Error("Project starting");if(h.current.loginState===o.M.true||h.current.loginState===o.M.validating||h.current.loginState===o.M.validateError)throw Error("Already login");try{let n=await (0,a.c)(e,t);if((null==n?void 0:n.code)!==c.mI)return!1;return p({loginState:o.M.true,username:n.data.nickName,token:n.data.token}),(0,s.cM)("log in success",r),!0}catch(e){return e instanceof Error?(0,s.cM)(e.message,r):(0,s.cM)(e,r),!1}},[p]),x=(0,l.useCallback)(async()=>(p({loginState:o.M.loggingOut,username:h.current.username,token:h.current.token}),await (0,s.gw)(2e3),p({loginState:o.M.false,username:"",token:""}),!0),[p]),y=(0,l.useMemo)(()=>({authConfig:r,login:v,logout:x}),[r,v,x]);return(0,l.useEffect)(()=>{let e=async()=>{let{loginState:e,username:t,token:r}=m();if(e===o.M.true||e===o.M.validateError){p({loginState:o.M.validating,username:t,token:r});try{p({loginState:o.M.true,username:t,token:r})}catch(e){e instanceof Error?(0,s.cM)(e.message,i.L.message):(0,s.cM)(e,i.L.message),p({loginState:o.M.validateError,username:t,token:r})}}else p({loginState:o.M.false,username:"",token:""})};e()},[p]),(0,n.jsx)(g.Provider,{value:y,children:t})});f.displayName="AuthProvider"},7613:function(e){"use strict";e.exports={output:"export",basePath:"/historic-site-portal-demo"}},4161:function(e,t,r){"use strict";var n,a;r.d(t,{M:function(){return n}}),(a=n||(n={})).none="none",a.validating="validating",a.validateError="validateError",a.true="true",a.false="false",a.loggingOut="loggingOut"},2624:function(e,t,r){"use strict";var n,a;r.d(t,{L:function(){return n}}),(a=n||(n={})).none="none",a.console="console",a.message="message"},9153:function(e,t,r){"use strict";var n,a;r.d(t,{L:function(){return n}}),(a=n||(n={})).primary="primary",a.dark="dark",a.danger="danger",a.green="green"},666:function(e,t,r){"use strict";r.d(t,{FH:function(){return n},M7:function(){return o},mI:function(){return i},px:function(){return a}});let n="https://historical-site-backend-18d1df54380f.herokuapp.com",a="token",o=!1,i=200},5474:function(e,t,r){"use strict";r.d(t,{cM:function(){return s},gw:function(){return i},rn:function(){return c},sG:function(){return l}});var n=r(2624),a=r(5326),o=r.n(a);let i=async e=>{await new Promise(t=>setTimeout(t,e))},s=(e,t)=>{switch(t){case n.L.none:break;case n.L.console:case n.L.message:console.log(e)}};function c(e){return e?o()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}let l=(async()=>{}).constructor},4121:function(){},6408:function(){},2082:function(e){e.exports={wrapper:"AdminLayout_wrapper__1qyET"}},9279:function(e){e.exports={wrapper:"Nav_wrapper__inB0k",activate:"Nav_activate__8tx0l"}},984:function(e){e.exports={wrapper:"Header_wrapper___4abJ"}},6297:function(e){e.exports={wrapper:"Root_wrapper__oqOcq"}},1576:function(e){e.exports={primary:"Button_primary__Nhi6i",danger:"Button_danger__214td",dark:"Button_dark__Djc0e"}},8414:function(e){e.exports={center:"Center_center__ucmSV"}}},function(e){e.O(0,[550,720,56,253,488,744],function(){return e(e.s=4338)}),_N_E=e.O()}]);