(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{8159:function(e,t,n){Promise.resolve().then(n.bind(n,7219)),Promise.resolve().then(n.bind(n,2948)),Promise.resolve().then(n.t.bind(n,4121,23)),Promise.resolve().then(n.t.bind(n,6408,23)),Promise.resolve().then(n.t.bind(n,962,23)),Promise.resolve().then(n.t.bind(n,6297,23))},6653:function(e,t,n){"use strict";n.d(t,{L:function(){return o},c:function(){return s}});var r=n(5474),a=n(666);function o(){return localStorage.getItem(a.px)}async function i(){return await (0,r.gw)(2e3),{code:a.mI,message:"Mock",data:{nickName:"Mock",token:"Mock"}}}async function s(e,t){if(a.M7)return await i();let n=await fetch("".concat(a.FH,"/member/login"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:e,password:t})});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));return await n.json()}},2948:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var r=n(9268),a=n(6006),o=n(984),i=n.n(o),s=n(5846),c=n.n(s),u=n(6008),l=n(9279),d=n.n(l),m=n(8683),f=n.n(m),g=n(7613),p=n.n(g);let h=[{href:"/member",title:"會員管理"},{href:"/restoration",title:"古蹟修復管理"},{href:"/landmark",title:"古蹟列表管理"},{href:"/store",title:"商家資訊管理"}],v=(0,a.memo)(e=>{let{href:t,children:n}=e,a=(0,u.usePathname)();return(0,r.jsx)(c(),{className:f()({[d().activate]:"".concat(p().basePath?p().basePath:"").concat(t)===a}),href:t,children:n})});v.displayName="NavItem";let x=(0,a.memo)(()=>(0,r.jsx)("div",{className:d().wrapper,children:h.map(e=>{let{href:t,title:n}=e;return(0,r.jsx)(v,{href:t,children:n},t)})}));x.displayName="Nav";var y=n(6624),b=n(6831),M=n(4161),k=n(7454),w=n(9153);let j=(0,a.memo)(()=>{let{authConfig:{loginState:e,username:t},logout:n}=(0,a.useContext)(y.V);return(0,r.jsxs)("div",{className:f()(i().wrapper,"z-[1000]"),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(k.Z,{src:"/images/logo.jpg",width:50,height:50,alt:"潮古蹟標誌"}),(0,r.jsx)("h3",{children:"潮古蹟"}),(0,r.jsx)(x,{})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:t}),(0,r.jsx)(b.Z,{loading:e===M.M.loggingOut,onClick:n,looks:w.L.dark,children:"登出"})]})]})});j.displayName="Navbar";var N=n(2082),_=n.n(N);let S=(0,a.memo)(e=>{let{children:t}=e,{authConfig:{loginState:n}}=(0,a.useContext)(y.V);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j,{}),(0,r.jsx)("div",{className:_().wrapper,children:(n===M.M.true||n===M.M.loggingOut)&&t})]})});S.displayName="AdminLayout";var E=S},7219:function(e,t,n){"use strict";n.r(t);var r=n(9268),a=n(3099),o=n(3368),i=n(6624),s=n(4161),c=n(6006);let u=(0,c.memo)(e=>{let{loginPage:t,adminPage:n}=e,{authConfig:{loginState:u}}=(0,c.useContext)(i.V);switch(u){case s.M.none:return(0,r.jsx)(a.Z,{children:(0,r.jsx)(o.Z,{})});case s.M.validating:return(0,r.jsx)(o.Z,{expand:!0,children:n});case s.M.true:case s.M.validateError:case s.M.loggingOut:return n;case s.M.false:return t}});u.displayName="AuthRoute";let l=(0,c.memo)(e=>{let{loginPage:t,adminPage:n}=e;return(0,r.jsx)(i.H,{children:(0,r.jsx)(u,{loginPage:t,adminPage:n})})});l.displayName="AuthRouteWrapper",t.default=l},7454:function(e,t,n){"use strict";var r=n(9268),a=n(6394),o=n.n(a),i=n(6006),s=n(8582);let c=(0,i.memo)((0,i.forwardRef)((e,t)=>{let{src:n,...a}=e;return(0,r.jsx)(o(),{...a,ref:t,unoptimized:!0,src:"string"==typeof n?(0,s.A0)(n):n})}));c.displayName="CustomImage",t.Z=c},6831:function(e,t,n){"use strict";var r=n(9268),a=n(6006),o=n(3368),i=n(1576),s=n.n(i),c=n(8683),u=n.n(c),l=n(9153);let d=(0,a.memo)(e=>{let{className:t,children:n,type:a,loading:i,disabled:c,onClick:d,looks:m,icon:f,...g}=e;return(0,r.jsxs)("button",{...g,className:"close"===f?u()("h-8 w-8 bg-close bg-4 bg-center bg-no-repeat opacity-50 hover:opacity-75",t):u()("rounded px-3 py-1.5",{[s().primary]:!m||m===l.L.primary,"bg-gray-100":m===l.L.secondary,[s().danger]:m===l.L.danger,[s().dark]:m===l.L.dark,"bg-green-700 text-white":m===l.L.green},t),disabled:i||c,onClick:d,type:a,children:[i&&(0,r.jsx)(o.Z,{size:o.v.small})," ",n]})});d.displayName="Button",t.Z=d},3099:function(e,t,n){"use strict";var r=n(9268),a=n(6006),o=n(8414),i=n.n(o);let s=(0,a.memo)(e=>{let{children:t}=e;return(0,r.jsx)("div",{className:i().center,children:(0,r.jsx)("div",{children:t})})});s.displayName="Center",t.Z=s},3368:function(e,t,n){"use strict";n.d(t,{v:function(){return a}});var r,a,o=n(9268),i=n(6006),s=n(8683),c=n.n(s);(r=a||(a={})).small="small",r.medium="medium";let u=(0,i.memo)(e=>{let{spinning:t=!0,size:n=a.medium,expand:r=!1,children:i}=e;return(0,o.jsxs)("div",{className:c()("relative inline-block",{"h-full w-full":r}),children:[i,t&&(0,o.jsx)("div",{className:c()("inset-0 flex items-center justify-center",{"absolute bg-white opacity-70":i,"static bg-transparent":!i}),children:(0,o.jsx)("div",{className:c()("animate-spin rounded-full border-solid border-slate-100 border-t-blue-500",{"h-2.5 w-2.5 border-2":n===a.small,"h-10 w-10 border-4":n===a.medium})})})]})});u.displayName="Spin",t.Z=u},158:function(e,t,n){"use strict";var r=n(9268),a=n(6006),o=n(6292),i=n(8683),s=n.n(i);let c=(0,a.memo)(e=>{let{children:t,icon:n,removeModal:o}=e,[i,c]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{let e=setTimeout(()=>{c(!1),e=setTimeout(()=>{o()},300)},3e3);return()=>{clearTimeout(e)}},[o]),(0,r.jsxs)("div",{className:s()("my-2 rounded bg-white px-4 py-2 shadow",{"animate-fade-in":i,"animate-fade-out":!i}),children:[n," ",t]})});function u(e,t){let n=(0,o.E)("toastContainer","fixed left-1/2 top-0 z-[2000] -translate-x-1/2 transform"),{render:a,removeModal:i}=(0,o.k)(n);a((0,r.jsx)(c,{icon:t,removeModal:i,children:e}))}c.displayName="Toast",t.Z={success:e=>{u(e,"success:")},error:e=>{u(e,"error:")}}},6292:function(e,t,n){"use strict";n.d(t,{E:function(){return a},k:function(){return o}});var r=n(3194);function a(e,t){let n=document.getElementById(e);return n||((n=document.createElement("div")).id=e,t&&(n.className=t),document.body.appendChild(n)),n}function o(e){let t=document.createElement("div");e.appendChild(t);let n=(0,r.createRoot)(t);return{render:e=>{n.render(e)},removeModal:()=>{n.unmount(),null==e||e.removeChild(t)}}}},6624:function(e,t,n){"use strict";n.d(t,{H:function(){return p},V:function(){return g}});var r=n(9268),a=n(6653),o=n(158),i=n(4161),s=n(2624),c=n(5474),u=n(666),l=n(6006);let d="loginState",m="username",f=()=>{let e=localStorage.getItem(d)||"",t=localStorage.getItem(m)||"",n=localStorage.getItem(u.px)||"";return e in i.M?{loginState:e,username:t,token:n}:{loginState:i.M.none,username:"",token:""}},g=(0,l.createContext)({authConfig:{loginState:i.M.none,username:"",token:""},login:async()=>{throw Error("AuthProvider not found")},logout:async()=>{throw Error("AuthProvider not found")}}),p=(0,l.memo)(e=>{let{children:t}=e,[n,p]=(0,l.useState)({loginState:i.M.none,username:"",token:""}),h=(0,l.useRef)(n);h.current=n;let v=(0,l.useCallback)(e=>{let{loginState:t,username:n,token:r}=e;p({loginState:t,username:n,token:r}),localStorage.setItem(d,t),localStorage.setItem(m,n),localStorage.setItem(u.px,r)},[]),x=(0,l.useCallback)(async function(e,t){let{logType:n=s.L.none}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(h.current.loginState===i.M.none)throw Error("Project starting");if(h.current.loginState===i.M.true||h.current.loginState===i.M.validating||h.current.loginState===i.M.validateError)throw Error("Already login");try{let r=await (0,a.c)(e,t);if((null==r?void 0:r.code)!==u.mI)return o.Z.error(null==r?void 0:r.message),!1;return o.Z.success("成功"),v({loginState:i.M.true,username:r.data.nickName,token:r.data.token}),(0,c.cM)("log in success",n),!0}catch(e){return e instanceof Error?(0,c.cM)(e.message,n):(0,c.cM)(e,n),!1}},[v]),y=(0,l.useCallback)(async()=>(v({loginState:i.M.loggingOut,username:h.current.username,token:h.current.token}),await (0,c.gw)(1e3),v({loginState:i.M.false,username:"",token:""}),!0),[v]),b=(0,l.useMemo)(()=>({authConfig:n,login:x,logout:y}),[n,x,y]);return(0,l.useEffect)(()=>{let e=async()=>{let{loginState:e,username:t,token:n}=f();if(e===i.M.true||e===i.M.validateError){v({loginState:i.M.validating,username:t,token:n});try{v({loginState:i.M.true,username:t,token:n})}catch(e){e instanceof Error?(0,c.cM)(e.message,s.L.message):(0,c.cM)(e,s.L.message),v({loginState:i.M.validateError,username:t,token:n})}}else v({loginState:i.M.false,username:"",token:""})};e()},[v]),(0,r.jsx)(g.Provider,{value:b,children:t})});p.displayName="AuthProvider"},7613:function(e){"use strict";e.exports={output:"export",basePath:"/historic-site-portal-demo-test"}},4161:function(e,t,n){"use strict";var r,a;n.d(t,{M:function(){return r}}),(a=r||(r={})).none="none",a.validating="validating",a.validateError="validateError",a.true="true",a.false="false",a.loggingOut="loggingOut"},2624:function(e,t,n){"use strict";var r,a;n.d(t,{L:function(){return r}}),(a=r||(r={})).none="none",a.console="console",a.message="message"},9153:function(e,t,n){"use strict";var r,a;n.d(t,{L:function(){return r}}),(a=r||(r={})).primary="primary",a.secondary="secondary",a.dark="dark",a.danger="danger",a.green="green"},666:function(e,t,n){"use strict";n.d(t,{FH:function(){return r},M7:function(){return o},mI:function(){return i},px:function(){return a}});let r="https://historical-site-backend-18d1df54380f.herokuapp.com",a="token",o=!1,i="S001"},5474:function(e,t,n){"use strict";n.d(t,{cM:function(){return s},gw:function(){return i},o2:function(){return l},rn:function(){return c},sG:function(){return u}});var r=n(2624),a=n(5326),o=n.n(a);let i=async e=>{await new Promise(t=>setTimeout(t,e))},s=(e,t)=>{switch(t){case r.L.none:break;case r.L.console:case r.L.message:console.log(e)}};function c(e){return e?o()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}let u=(async()=>{}).constructor;function l(e){return Object.fromEntries(Object.entries(e).filter(e=>{let[,t]=e;return void 0!==t}))}},8582:function(e,t,n){"use strict";n.d(t,{$x:function(){return c},A0:function(){return l},Qv:function(){return u},_b:function(){return d},qz:function(){return s}});var r=n(7613),a=n.n(r),o=n(3034),i=n(6008);let s="redirect",c="/member",u="/login";function l(e){return e.startsWith("/")&&a().basePath?"".concat(a().basePath).concat(e):e}function d(e,t){(0,i.redirect)("".concat(u).concat(e===l("/")?"":"?".concat(s,"=").concat(encodeURIComponent("".concat(e,"?").concat(t.toString())))),o.RedirectType.replace)}},4121:function(){},6408:function(){},2082:function(e){e.exports={wrapper:"AdminLayout_wrapper__1qyET"}},9279:function(e){e.exports={wrapper:"Nav_wrapper__inB0k",activate:"Nav_activate__8tx0l"}},984:function(e){e.exports={wrapper:"Header_wrapper___4abJ"}},6297:function(e){e.exports={wrapper:"Root_wrapper__oqOcq"}},1576:function(e){e.exports={primary:"Button_primary__Nhi6i",danger:"Button_danger__214td",dark:"Button_dark__Djc0e"}},8414:function(e){e.exports={center:"Center_center__ucmSV"}}},function(e){e.O(0,[550,263,748,253,488,744],function(){return e(e.s=8159)}),_N_E=e.O()}]);