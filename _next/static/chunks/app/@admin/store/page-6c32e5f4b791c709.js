(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[573],{3688:function(e,t,a){Promise.resolve().then(a.bind(a,7102))},7102:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var n,r,o=a(9268),s=a(5474),i=a(666),c=a(6653);async function l(){return await (0,s.gw)(2e3),{code:i.mI,message:"Mock",data:[{id:1,merchantName:"朝日夫婦",imageList:["/images/mock/朝日夫婦.jpeg"],locationX:"25.173531900733398",locationY:"121.43533051968141",address:"251新北市淡水區中正路233-3號",link:"http://www.123.com",description:"好吃的日式冰店。",operator:"admin01",updateTime:"2023-06-19 23:30:45",createTime:"2023-06-19 23:30:45"}]}}async function d(){if(i.M7)return await l();let e=await fetch("".concat(i.FH,"/merchants"),{method:"GET",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,c.L)())}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}async function m(){return await (0,s.gw)(2e3),{code:i.mI,message:"Mock",data:{id:1,merchantName:"朝日夫婦",imageList:["/images/mock/朝日夫婦.jpeg"],locationX:"25.173531900733398",locationY:"121.43533051968141",address:"251新北市淡水區中正路233-3號",link:"http://www.123.com",description:"好吃的日式冰店。",operator:"admin01",updateTime:"2023-06-19 23:30:45",createTime:"2023-06-19 23:30:45"}}}async function u(e){if(i.M7)return m();let t=await fetch("".concat(i.FH,"/merchants/").concat(e),{method:"GET",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,c.L)())}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}async function h(e){return await (0,s.gw)(2e3),{code:i.mI,message:"mock"}}async function f(e){if(i.M7)return h(e);let t=await fetch("".concat(i.FH,"/merchants/save"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,c.L)())},body:JSON.stringify(e)});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}async function p(e,t){return await (0,s.gw)(2e3),{code:i.mI,message:"mock"}}async function x(e,t){if(i.M7)return p(e,t);let a=await fetch("".concat(i.FH,"/merchants/").concat(e),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,c.L)())},body:JSON.stringify(t)});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return await a.json()}async function j(){return await (0,s.gw)(2e3),{code:i.mI,message:"mock"}}async function g(e){if(i.M7)return await j();let t=await fetch("".concat(i.FH,"/merchants/").concat(e),{method:"DELETE",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,c.L)())}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}var w=a(7454),k=a(6831),N=a(1263),b=a(8302),v=a(1904),y=a(9153),T=a(6006),C=a(2908),I=a(7007),L=a(3368),E=a(1897),Z=a(315),M=a(5503),P=a(2238),S=a(6497);async function H(e){try{let t=await u(e);if((null==t?void 0:t.code)!==i.mI)return;return t.data}catch(e){}}async function F(e){let{values:t,id:a,type:n}=e,[o,s]=t.coordinate.split(",").map(e=>e.trim());switch(console.log(t),n){case r.add:return await f({merchantName:t.merchantName,locationX:o,locationY:s,address:t.address,description:t.description,imageList:t.imageList.filter(e=>void 0!==e),link:t.link});case r.edit:return await x(a,{merchantName:t.merchantName,locationX:o,locationY:s,address:t.address,description:t.description,imageList:t.imageList.filter(e=>void 0!==e),link:t.link});default:throw Error("Invalid type")}}(n=r||(r={}))[n.add=0]="add",n[n.edit=1]="edit";let z="store-form",A=(0,T.memo)(e=>{let{open:t,id:a,onClose:n,afterAdd:s,afterEdit:c}=e,l=void 0===a?r.add:r.edit,d=(0,T.useRef)(),{run:m,reset:u,loading:h}=(0,v.Q)(H);(0,T.useEffect)(()=>{let e=!1;return(async()=>{if(t){var n,r,o;if(a){let t=await m(a);!e&&t?null===(n=d.current)||void 0===n||n.initialize({...t,coordinate:"".concat(t.locationX,", ").concat(t.locationY)}):(u(),null===(r=d.current)||void 0===r||r.reset())}else null===(o=d.current)||void 0===o||o.initialize({imageList:[void 0]})}})(),()=>{e=!0}},[t,a,m,u]);let{run:f}=(0,v.Q)(F);return(0,o.jsx)(I.Z,{open:t,title:"商店資訊",footer:(0,o.jsx)("div",{className:"flex justify-end",children:(0,o.jsx)(k.Z,{form:z,type:"submit",looks:y.L.dark,children:"保存"})}),width:554,isCloseButtonShow:!0,onClose:n,maskClosable:!1,children:(0,o.jsx)(L.Z,{expand:!0,spinning:h,children:(0,o.jsx)(C.l0,{onSubmit:async e=>{let t=await f({values:e,id:a,type:l});(null==t?void 0:t.code)!==i.mI||(n(),l===r.add?s():c())},mutators:{...P.Z},render:e=>{let{form:t,handleSubmit:a,values:n}=e;return d.current=t,console.log(n),(0,o.jsxs)("form",{id:z,onSubmit:a,children:[(0,o.jsxs)("div",{className:"m-2",children:[(0,o.jsx)("label",{className:"mb-2 block",children:"商店名稱"}),(0,o.jsx)(C.gN,{name:"merchantName",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,o.jsx)(N.Z,{className:"block w-full text-sm",value:t,onChange:a})}})]}),(0,o.jsxs)("div",{className:"m-2",children:[(0,o.jsx)("label",{className:"mb-2 block",children:"座標位置"}),(0,o.jsx)(C.gN,{name:"coordinate",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,o.jsx)(N.Z,{className:"block w-full text-sm",value:t,onChange:a,placeholder:"請輸入古蹟座標位置(google map中按右鍵可複製座標)"})}})]}),(0,o.jsxs)("div",{className:"m-2",children:[(0,o.jsx)("label",{className:"mb-2 block",children:"商店地址"}),(0,o.jsx)(C.gN,{name:"address",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,o.jsx)(N.Z,{className:"block w-full text-sm",value:t,onChange:a})}})]}),(0,o.jsxs)("div",{className:"m-2",children:[(0,o.jsx)("label",{className:"mb-2 block",children:"商店描述"}),(0,o.jsx)(C.gN,{name:"description",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,o.jsx)(E.Z,{className:"block w-full text-sm",value:t,onChange:a})}})]}),(0,o.jsxs)("div",{className:"m-2",children:[(0,o.jsx)("label",{className:"mb-2 block",children:"新增圖片"}),(0,o.jsx)(S.F2,{name:"imageList",render:e=>{let{fields:t}=e;return t.map(e=>(0,o.jsx)(C.gN,{name:e,render:e=>{let{input:{value:t,onChange:a}}=e;return(0,o.jsx)(Z.Z,{accept:"image/*",fileType:M.p.IMAGE,value:t,onChange:a})}},e))}})]}),(0,o.jsxs)("div",{className:"m-2",children:[(0,o.jsx)("label",{className:"mb-2 block",children:"相關連結"}),(0,o.jsx)(C.gN,{name:"link",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,o.jsx)(N.Z,{className:"block w-full text-sm",value:t,onChange:a})}})]})]})}})})})});async function B(e){console.log(e);try{let e=await d();if((null==e?void 0:e.code)!==i.mI)return[];return e.data}catch(e){return[]}}A.displayName="FormModal";let O=(0,T.memo)(()=>{let{run:e,refresh:t,data:a,loading:n}=(0,v.Q)(B,{manual:!1}),{openModal:r,formModalProps:s}=function(){let[e,t]=(0,T.useState)({open:!1}),a=(0,T.useCallback)(e=>{t({id:e,open:!0})},[]),n=(0,T.useCallback)(()=>{t({open:!1})},[]);return(0,T.useMemo)(()=>({openModal:a,formModalProps:{...e,onClose:n}}),[a,e,n])}(),i=(0,T.useMemo)(()=>[{title:"ID",dataIndex:"id"},{title:"商店名稱",dataIndex:"merchantName"},{title:"座標位置",render:(e,t)=>"".concat(t.locationX,", ").concat(t.locationY)},{title:"商店地址",dataIndex:"address"},{title:"商店描述",dataIndex:"description"},{title:"封面照",dataIndex:"imageList",render:e=>(0,o.jsx)(w.Z,{className:"h-24 w-24 min-w-24 object-cover",src:null==e?void 0:e[0],width:100,height:100,alt:"封面照"})},{title:"相關連結",dataIndex:"link",render:e=>(0,o.jsx)("a",{className:"text-blue-500 hover:underline",href:e,target:"_blank",children:e})},{title:"操作者",dataIndex:"operator"},{title:"操作時間",dataIndex:"updateTime"},{title:"操作",render:(e,a)=>(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsx)(k.Z,{looks:y.L.green,onClick:()=>{r(a.id)},children:"編輯"}),(0,o.jsx)(k.Z,{looks:y.L.danger,onClick:()=>{I.Z.confirm({content:(0,o.jsx)("p",{children:"是否確認刪除？"}),onOk:async()=>{await g(a.id),t()},okButtonProps:{looks:y.L.danger}})},children:"刪除"})]})}],[t,r]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsx)(C.l0,{onSubmit:e,render:e=>{let{handleSubmit:t}=e;return(0,o.jsx)("form",{onSubmit:t,children:(0,o.jsx)(C.gN,{name:"idOrName",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,o.jsx)(N.Z,{value:t,onChange:a,placeholder:"請輸入商店名稱或ID"})}})})}}),(0,o.jsx)(k.Z,{looks:y.L.dark,onClick:()=>{r()},children:"新增商店"})]}),(0,o.jsx)(b.Z,{className:"mt-6",columns:i,dataSource:a,loading:n}),(0,o.jsx)(A,{...s,afterAdd:e,afterEdit:t})]})});O.displayName="StorePage";var _=O}},function(e){e.O(0,[550,720,656,264,253,488,744],function(){return e(e.s=3688)}),_N_E=e.O()}]);