(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[573],{3688:function(e,t,n){Promise.resolve().then(n.bind(n,8402))},6653:function(e,t,n){"use strict";n.d(t,{L:function(){return s},c:function(){return l}});var a=n(5474),r=n(666);function s(){return localStorage.getItem(r.px)}async function o(){return await (0,a.gw)(2e3),{code:r.mI,message:"Mock",data:{nickName:"Mock",token:"Mock"}}}async function l(e,t){if(r.M7)return await o();let n=await fetch("".concat(r.FH,"/member/login"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:e,password:t})});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));return await n.json()}},8402:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return L}});var a=n(9268),r=n(5474),s=n(666),o=n(6653);async function l(){return await (0,r.gw)(2e3),{code:s.mI,message:"Mock",data:[{id:1,merchantName:"朝日夫婦",imageList:["/images/mock/朝日夫婦.jpeg"],locationX:"25.173531900733398",locationY:"121.43533051968141",address:"251新北市淡水區中正路233-3號",link:"http://www.123.com",description:"好吃的日式冰店。",operator:"admin01",updateTime:"2023-06-19 23:30:45",createTime:"2023-06-19 23:30:45"}]}}async function i(){if(s.M7)return await l();let e=await fetch("".concat(s.FH,"/management/merchants"),{method:"GET",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,o.L)())}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}async function c(){return await (0,r.gw)(2e3),{code:s.mI,message:"Mock",data:{id:1,merchantName:"朝日夫婦",imageList:["/images/mock/朝日夫婦.jpeg"],locationX:"25.173531900733398",locationY:"121.43533051968141",address:"251新北市淡水區中正路233-3號",link:"http://www.123.com",description:"好吃的日式冰店。",operator:"admin01",updateTime:"2023-06-19 23:30:45",createTime:"2023-06-19 23:30:45"}}}async function d(e){if(s.M7)return c();let t=await fetch("".concat(s.FH,"/merchants/").concat(e),{method:"GET",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,o.L)())}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}async function u(){return await (0,r.gw)(2e3),{code:s.mI,message:"mock"}}async function m(e){if(s.M7)return await u();let t=await fetch("".concat(s.FH,"/merchants/").concat(e),{method:"DELETE",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,o.L)())}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}var h=n(7454),f=n(6831),p=n(1263),x=n(8302),g=n(1904),b=n(9153),j=n(6006),k=n(2313),w=n(7007),v=n(3368),y=n(1897);let N=(0,j.memo)(e=>{let{className:t,accept:n,value:s,onChange:o}=e,{data:l,loading:i,run:c}=(0,g.Q)(async e=>{console.log(e),await (0,r.gw)(2e3)}),d=(0,j.useRef)(null);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{className:"hidden",type:"file",accept:n,ref:d,onChange:async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&await c(n)}}),(0,a.jsx)(v.Z,{spinning:i,children:(0,a.jsx)(h.Z,{className:"h-24 w-24 cursor-pointer object-cover",src:"/images/mock/add-image.png",width:100,height:100,alt:"add",onClick:()=>{d.current.click()}})})]})});async function C(e){try{let t=await d(e);if((null==t?void 0:t.code)!==s.mI)return;return t.data}catch(e){}}async function Z(e){}N.displayName="Upload";let M=(0,j.memo)(e=>{let{open:t,id:n,onClose:r}=e,s=(0,j.useRef)(),{run:o,reset:l,loading:i}=(0,g.Q)(C);(0,j.useEffect)(()=>{let e=!1;return(async()=>{var a,r;if(t&&n){let t=await o(n);!e&&t&&(null===(a=s.current)||void 0===a||a.initialize(t))}else l(),null===(r=s.current)||void 0===r||r.reset()})(),()=>{e=!0}},[t,n,o,l]);let{run:c}=(0,g.Q)(Z);return(0,a.jsx)(w.Z,{open:t,title:"商店資訊",footer:(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(f.Z,{looks:b.L.dark,children:"保存"})}),width:554,isCloseButtonShow:!0,onClose:r,maskClosable:!1,children:(0,a.jsx)(v.Z,{expand:!0,spinning:i,children:(0,a.jsx)(k.l0,{onSubmit:c,render:e=>{let{form:t,handleSubmit:n}=e;return s.current=t,(0,a.jsxs)("form",{onSubmit:n,children:[(0,a.jsxs)("div",{className:"m-2",children:[(0,a.jsx)("label",{className:"mb-2 block",children:"商店名稱"}),(0,a.jsx)(k.gN,{name:"merchantName",render:e=>{let{input:{value:t,onChange:n}}=e;return(0,a.jsx)(p.Z,{className:"block w-full text-sm",value:t,onChange:n})}})]}),(0,a.jsxs)("div",{className:"m-2",children:[(0,a.jsx)("label",{className:"mb-2 block",children:"座標位置"}),(0,a.jsx)(k.gN,{name:"TODO:",render:e=>{let{input:{value:t,onChange:n}}=e;return(0,a.jsx)(p.Z,{className:"block w-full text-sm",value:t,onChange:n,placeholder:"請輸入古蹟座標位置(google map中按右鍵可複製座標)"})}})]}),(0,a.jsxs)("div",{className:"m-2",children:[(0,a.jsx)("label",{className:"mb-2 block",children:"商店地址"}),(0,a.jsx)(k.gN,{name:"address",render:e=>{let{input:{value:t,onChange:n}}=e;return(0,a.jsx)(p.Z,{className:"block w-full text-sm",value:t,onChange:n})}})]}),(0,a.jsxs)("div",{className:"m-2",children:[(0,a.jsx)("label",{className:"mb-2 block",children:"商店描述"}),(0,a.jsx)(k.gN,{name:"description",render:e=>{let{input:{value:t,onChange:n}}=e;return(0,a.jsx)(y.Z,{className:"block w-full text-sm",value:t,onChange:n})}})]}),(0,a.jsxs)("div",{className:"m-2",children:[(0,a.jsx)("label",{className:"mb-2 block",children:"新增圖片"}),(0,a.jsx)(N,{accept:"image/*"})]}),(0,a.jsxs)("div",{className:"m-2",children:[(0,a.jsx)("label",{className:"mb-2 block",children:"相關連結"}),(0,a.jsx)(k.gN,{name:"link",render:e=>{let{input:{value:t,onChange:n}}=e;return(0,a.jsx)(p.Z,{className:"block w-full text-sm",value:t,onChange:n})}})]})]})}})})})});async function T(e){console.log(e);try{let e=await i();if((null==e?void 0:e.code)!==s.mI)return[];return e.data}catch(e){return[]}}M.displayName="EditModal";let _=(0,j.memo)(()=>{let{run:e,refresh:t,data:n,loading:r}=(0,g.Q)(T,{manual:!1}),{openModal:s,editModalProps:o}=function(){let[e,t]=(0,j.useState)({open:!1}),n=(0,j.useCallback)(e=>{t({id:e,open:!0})},[]),a=(0,j.useCallback)(()=>{t({open:!1})},[]);return(0,j.useMemo)(()=>({openModal:n,editModalProps:{...e,onClose:a}}),[n,e,a])}(),l=(0,j.useMemo)(()=>[{title:"ID",dataIndex:"id"},{title:"商店名稱",dataIndex:"merchantName"},{title:"座標位置",render:(e,t)=>"".concat(t.locationX,", ").concat(t.locationY)},{title:"商店地址",dataIndex:"address"},{title:"商店描述",dataIndex:"description"},{title:"封面照",dataIndex:"imageList",render:e=>(0,a.jsx)(h.Z,{className:"h-24 w-24 min-w-24 object-cover",src:null==e?void 0:e[0],width:100,height:100,alt:"封面照"})},{title:"相關連結",dataIndex:"link",render:e=>(0,a.jsx)("a",{className:"text-blue-500 hover:underline",href:e,target:"_blank",children:e})},{title:"操作者",dataIndex:"operator"},{title:"操作時間",dataIndex:"updateTime"},{title:"操作",render:(e,n)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(f.Z,{looks:b.L.green,onClick:()=>{s(n.id)},children:"編輯"}),(0,a.jsx)(f.Z,{looks:b.L.danger,onClick:()=>{w.Z.confirm({content:(0,a.jsx)("p",{children:"是否確認刪除？"}),onOk:async()=>{await m(n.id),t()},okButtonProps:{looks:b.L.danger}})},children:"刪除"})]})}],[t,s]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(k.l0,{onSubmit:e,render:e=>{let{handleSubmit:t}=e;return(0,a.jsx)("form",{onSubmit:t,children:(0,a.jsx)(k.gN,{name:"idOrName",render:e=>{let{input:{value:t,onChange:n}}=e;return(0,a.jsx)(p.Z,{value:t,onChange:n,placeholder:"請輸入商店名稱或ID"})}})})}}),(0,a.jsx)(f.Z,{looks:b.L.dark,onClick:()=>{s()},children:"新增商店"})]}),(0,a.jsx)(x.Z,{className:"mt-6",columns:l,dataSource:n,loading:r}),(0,a.jsx)(M,{...o})]})});_.displayName="StorePage";var L=_},7454:function(e,t,n){"use strict";var a=n(9268),r=n(6394),s=n.n(r),o=n(6006),l=n(7613),i=n.n(l);let c=(0,o.memo)((0,o.forwardRef)((e,t)=>{let{src:n,...r}=e;return(0,a.jsx)(s(),{...r,ref:t,unoptimized:!0,src:"string"==typeof n&&n.startsWith("/")&&i().basePath?"".concat(i().basePath).concat(n):n})}));c.displayName="CustomImage",t.Z=c},6831:function(e,t,n){"use strict";var a=n(9268),r=n(6006),s=n(3368),o=n(1576),l=n.n(o),i=n(8683),c=n.n(i),d=n(9153);let u=(0,r.memo)(e=>{let{className:t,children:n,loading:r,disabled:o,htmlType:i,onClick:u,looks:m,icon:h}=e;return(0,a.jsxs)("button",{className:"close"===h?c()("h-8 w-8 bg-close bg-4 bg-center bg-no-repeat opacity-50 hover:opacity-75",t):c()("rounded px-3 py-1.5",{[l().primary]:!m||m===d.L.primary,[l().danger]:m===d.L.danger,[l().dark]:m===d.L.dark,"bg-green-700 text-white":m===d.L.green},t),disabled:r||o,onClick:u,type:i,children:[r&&(0,a.jsx)(s.Z,{size:s.v.small})," ",n]})});u.displayName="Button",t.Z=u},1263:function(e,t,n){"use strict";var a=n(9268),r=n(6006),s=n(8683),o=n.n(s);let l=(0,r.memo)((0,r.forwardRef)((e,t)=>{let{className:n,type:r,value:s,onChange:l,onKeyDown:i,disabled:c,placeholder:d}=e;return(0,a.jsx)("input",{className:o()("rounded border border-solid border-gray-300 p-1",n),type:r,value:s,onChange:e=>{let t=e.target.value;null==l||l(t)},onKeyDown:i,disabled:c,placeholder:d,ref:t})}));t.Z=l},7007:function(e,t,n){"use strict";var a=n(9268),r=n(6006),s=n(8431),o=n(3194),l=n(4209),i=n.n(l),c=n(6831),d=n(8683),u=n.n(d);function m(e){let{title:t,children:n,footer:r,width:s,isCloseButtonShow:o,maskClosable:l,onClose:d}=e;return(0,a.jsx)("div",{className:u()(i().backgroundMask,"z-[1500]"),onClick:l?d:void 0,children:(0,a.jsxs)("div",{className:"my-12 divide-y divide-solid rounded bg-white",style:{width:s},onClick:e=>{e.stopPropagation()},children:[t&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 text-xl font-medium",children:[t,o&&(0,a.jsx)(c.Z,{className:"p-2",icon:"close",onClick:d})]}),n&&(0,a.jsx)("div",{className:"p-4",children:n}),r&&(0,a.jsx)("div",{className:"p-4",children:r})]})})}let h=(0,r.memo)(e=>{let{title:t,children:n,footer:r,open:o=!1,width:l,isCloseButtonShow:i,maskClosable:c=!0,onClose:d}=e;return o&&(0,s.createPortal)((0,a.jsx)(m,{title:t,footer:r,width:l,isCloseButtonShow:i,maskClosable:c,onClose:d,children:n}),document.body)});h.displayName="Modal";let f=(0,r.memo)(e=>{let{content:t,onOk:n,okButtonProps:s,onCancel:o,cancelButtonProps:l}=e,[d,u]=(0,r.useState)(!1),[h,f]=(0,r.useState)(!1),p=(0,r.useCallback)(async()=>{u(!0),await (null==n?void 0:n()),u(!1)},[n]),x=(0,r.useCallback)(async()=>{f(!0),await (null==o?void 0:o()),f(!1)},[o]);return(0,a.jsxs)(m,{children:[t,(0,a.jsxs)("div",{className:i().buttonGroup,children:[(0,a.jsx)(c.Z,{...s,loading:d,disabled:h,onClick:p,children:"確定"}),(0,a.jsx)(c.Z,{...l,loading:h,disabled:d,onClick:x,children:"取消"})]})]})});f.displayName="ConfirmModal";let p="confirmModal";h.confirm=e=>{let{content:t,onOk:n,okButtonProps:r,onCancel:s,cancelButtonProps:l}=e,i=document.getElementById(p);i||((i=document.createElement("div")).id=p),document.body.appendChild(i);let c=(0,o.createRoot)(i);c.render((0,a.jsx)(f,{content:t,onOk:async()=>{try{await (null==n?void 0:n()),c.unmount()}catch(e){}},okButtonProps:r,onCancel:async()=>{await (null==s?void 0:s()),c.unmount()},cancelButtonProps:l}))},t.Z=h},3368:function(e,t,n){"use strict";n.d(t,{v:function(){return r}});var a,r,s=n(9268),o=n(6006),l=n(8683),i=n.n(l);(a=r||(r={})).small="small",a.medium="medium";let c=(0,o.memo)(e=>{let{spinning:t=!0,size:n=r.medium,expand:a=!1,children:o}=e;return(0,s.jsxs)("div",{className:i()("relative inline-block",{"h-full w-full":a}),children:[o,t&&(0,s.jsx)("div",{className:i()("inset-0 flex items-center justify-center",{"absolute bg-white opacity-70":o,"static bg-transparent":!o}),children:(0,s.jsx)("div",{className:i()("animate-spin rounded-full border-solid border-slate-100 border-t-blue-500",{"h-2.5 w-2.5 border-2":n===r.small,"h-10 w-10 border-4":n===r.medium})})})]})});c.displayName="Spin",t.Z=c},8302:function(e,t,n){"use strict";var a=n(9268),r=n(6006),s=n(6462),o=n(3368),l=n(8683),i=n.n(l);let c=(0,r.memo)(e=>{let{className:t,rowKeyName:n="id",columns:l=[],dataSource:c=[],loading:d=!1}=e,u=(0,r.useMemo)(()=>l.map(e=>[e.dataIndex||(0,s.Z)(),e]),[l]),m=(0,r.useMemo)(()=>(0,a.jsx)("tr",{children:u.map(e=>{let[t,{title:n}]=e;return(0,a.jsx)("th",{className:"border-b border-solid border-gray-800 p-2 text-start",children:n},t)})}),[u]),h=(0,r.useMemo)(()=>c.map(e=>(0,a.jsx)("tr",{className:"even:bg-black/5",children:u.map(t=>{let[n,{dataIndex:r,render:s}]=t;return(0,a.jsx)("td",{className:"border-b border-solid border-gray-300 p-2",children:s?s(r&&e[r],e):r&&e[r]},n)})},e[n])),[u,c,n]);return(0,a.jsx)(o.Z,{spinning:d,expand:!0,children:(0,a.jsx)("div",{className:i()("overflow-auto",t),children:(0,a.jsx)("table",{className:"w-full border-collapse",children:(0,a.jsxs)("tbody",{children:[m,h]})})})})});c.displayName="Table",t.Z=c},1897:function(e,t,n){"use strict";var a=n(9268),r=n(8683),s=n.n(r),o=n(6006);let l=(0,o.memo)((0,o.forwardRef)((e,t)=>{let{className:n,value:r,onChange:o}=e;return(0,a.jsx)("textarea",{className:s()("rounded border border-solid border-gray-300 p-1",n),value:r,onChange:e=>{null==o||o(e.target.value)},ref:t})}));t.Z=l},1904:function(e,t,n){"use strict";n.d(t,{Q:function(){return s}});var a=n(6006),r=n(6462);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{manual:!0},n=(0,a.useRef)(t.manual),[s,o]=(0,a.useState)({loading:!1,data:void 0}),l=(0,a.useRef)(),i=(0,a.useRef)(!1),c=(0,a.useRef)(),d=(0,a.useCallback)(async function(){for(var t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];let s=(0,r.Z)();l.current=s,i.current=!0,c.current=n,o(e=>{let{data:t}=e;return{loading:!0,data:t}});let d=await e(...n);if(s!==l.current)throw Error("canceled");return o({loading:!1,data:d}),d},[e]),u=(0,a.useRef)(d),m=(0,a.useCallback)(async()=>{if(i.current)return await d(...c.current);throw Error("Run should be called first")},[d]),h=(0,a.useCallback)(()=>{let e=(0,r.Z)();l.current=e,o({loading:!1,data:void 0})},[]);return(0,a.useEffect)(()=>{n.current||u.current(...[])},[]),(0,a.useMemo)(()=>({run:d,refresh:m,reset:h,...s}),[d,m,h,s])}},7613:function(e){"use strict";e.exports={output:"export",basePath:"/historic-site-portal-demo-test"}},2624:function(e,t,n){"use strict";var a,r;n.d(t,{L:function(){return a}}),(r=a||(a={})).none="none",r.console="console",r.message="message"},9153:function(e,t,n){"use strict";var a,r;n.d(t,{L:function(){return a}}),(r=a||(a={})).primary="primary",r.dark="dark",r.danger="danger",r.green="green"},666:function(e,t,n){"use strict";n.d(t,{FH:function(){return a},M7:function(){return s},mI:function(){return o},px:function(){return r}});let a="https://historical-site-backend-18d1df54380f.herokuapp.com",r="token",s=!1,o="S001"},5474:function(e,t,n){"use strict";n.d(t,{cM:function(){return l},gw:function(){return o},rn:function(){return i},sG:function(){return c}});var a=n(2624),r=n(5326),s=n.n(r);let o=async e=>{await new Promise(t=>setTimeout(t,e))},l=(e,t)=>{switch(t){case a.L.none:break;case a.L.console:case a.L.message:console.log(e)}};function i(e){return e?s()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}let c=(async()=>{}).constructor},1576:function(e){e.exports={primary:"Button_primary__Nhi6i",danger:"Button_danger__214td",dark:"Button_dark__Djc0e"}},4209:function(e){e.exports={backgroundMask:"Modal_backgroundMask__9WqVi",buttonGroup:"Modal_buttonGroup__PS_fc"}}},function(e){e.O(0,[550,720,524,253,488,744],function(){return e(e.s=3688)}),_N_E=e.O()}]);