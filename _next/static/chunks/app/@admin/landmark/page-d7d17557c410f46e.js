(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[103],{7270:function(e,t,a){Promise.resolve().then(a.bind(a,6161))},6161:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var n,r,i=a(9268),o=a(8302),s=a(1904),c=a(6006),l=a(2908),d=a(1263),m=a(6831),u=a(9153),p=a(5474),g=a(666),h=a(6653);async function f(){return await (0,p.gw)(2e3),{code:g.mI,message:"Mock",data:[{id:1,caseName:"林家花園",locationX:"24.06109876319344",locationY:"120.70354094928975",address:"413台中市霧峰區萊園路91號",description:"設伝夫求釜燃景軍業論情再馬実。軽武以",coverImgUrl:"/images/mock/林家花園.jpeg",imageList:["/images/mock/林家花園.jpeg"],rotationList:["/images/mock/林家花園.jpeg"],videoList:["/images/mock/林家花園.jpeg"],operator:"admin01",operatorTime:"2023-06-19 23:30:45"}]}}async function j(e){if(g.M7)return await f();let t=new URLSearchParams(e).toString(),a=await fetch("".concat(g.FH,"/management/sites?").concat(t),{method:"GET",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,h.L)())}});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return await a.json()}async function x(){return await (0,p.gw)(2e3),{code:g.mI,message:"Mock",data:{id:1,caseName:"林家花園",locationX:"24.06109876319344",locationY:"120.70354094928975",address:"413台中市霧峰區萊園路91號",description:"設伝夫求釜燃景軍業論情再馬実。軽武以",coverImgUrl:"/images/mock/林家花園.jpeg",imageList:["/images/mock/林家花園.jpeg"],rotationList:["/images/mock/林家花園.jpeg"],videoList:["/images/mock/林家花園.jpeg"],operator:"admin01",operatorTime:"2023-06-19 23:30:45"}}}async function v(e){if(g.M7)return await x();let t=await fetch("".concat(g.FH,"/management/sites/").concat(e),{method:"GET",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,h.L)())}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}async function w(){return await (0,p.gw)(2e3),{code:g.mI,message:"mock"}}async function k(e){if(g.M7)return await w();let t=await fetch("".concat(g.FH,"/management/sites/save"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,h.L)())},body:JSON.stringify(e)});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}async function N(e,t){return await (0,p.gw)(2e3),{code:g.mI,message:"mock"}}async function b(e,t){if(g.M7)return await N(e,t);let a=await fetch("".concat(g.FH,"/management/sites/").concat(e),{method:"PUT",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,h.L)())},body:JSON.stringify(t)});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return await a.json()}async function L(){return await (0,p.gw)(2e3),{code:g.mI,message:"mock"}}async function y(e){if(g.M7)return await L();let t=await fetch("".concat(g.FH,"/management/sites/").concat(e),{method:"DELETE",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((0,h.L)())}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}var T=a(7007),C=a(3368),I=a(1897),E=a(2238),Z=a(6497),M=a(315),P=a(5503);async function S(e){try{let t=await v(e);if((null==t?void 0:t.code)!==g.mI)return;return t.data}catch(e){}}async function A(e){let{values:t,id:a,type:n}=e;console.log({values:t,type:n});let[i,o]=t.coordinate.split(",").map(e=>e.trim());switch(n){case r.add:return await k({caseName:t.caseName,locationX:i,locationY:o,address:t.address,description:t.description,imageList:t.imageList.filter(e=>void 0!==e),videoList:t.videoList.filter(e=>void 0!==e),rotationList:t.rotationList.filter(e=>void 0!==e)});case r.update:return await b(a,{caseName:t.caseName,locationX:i,locationY:o,address:t.address,description:t.description,imageList:t.imageList.filter(e=>void 0!==e),videoList:t.videoList.filter(e=>void 0!==e),rotationList:t.rotationList.filter(e=>void 0!==e)});default:throw Error("Invalid type")}}(n=r||(r={}))[n.add=0]="add",n[n.update=1]="update";let F="landmark-form",H=(0,c.memo)(e=>{let{open:t,id:a,onClose:n,afterAdd:o,afterEdit:p}=e,h=a?r.update:r.add,f=(0,c.useRef)(),{run:j,reset:x,loading:v}=(0,s.Q)(S);(0,c.useEffect)(()=>{let e=!1;return(async()=>{if(t){var n,r,i;if(a){let t=await j(a);!e&&t?null===(n=f.current)||void 0===n||n.initialize({...t,coordinate:"".concat(t.locationX,", ").concat(t.locationY)}):(x(),null===(r=f.current)||void 0===r||r.reset())}else null===(i=f.current)||void 0===i||i.initialize({imageList:[void 0],videoList:[void 0],rotationList:[void 0]})}})(),()=>{e=!0}},[a,t,x,j]);let{run:w}=(0,s.Q)(A);return(0,i.jsx)(T.Z,{open:t,title:"古蹟資訊",footer:(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(m.Z,{form:F,type:"submit",looks:u.L.dark,children:"保存"})}),width:554,isCloseButtonShow:!0,onClose:n,maskClosable:!1,children:(0,i.jsx)(C.Z,{expand:!0,spinning:v,children:(0,i.jsx)(l.l0,{onSubmit:async e=>{let t=await w({values:e,id:a,type:h});(null==t?void 0:t.code)!==g.mI||(n(),h===r.add?o():p())},mutators:{...E.Z},render:e=>{let{form:t,handleSubmit:a,values:n}=e;return f.current=t,console.log(n),(0,i.jsxs)("form",{id:F,onSubmit:a,children:[(0,i.jsxs)("div",{className:"m-2",children:[(0,i.jsx)("label",{className:"mb-2 block",children:"古蹟名稱"}),(0,i.jsx)(l.gN,{name:"caseName",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,i.jsx)(d.Z,{className:"block w-full text-sm",value:t,onChange:a})}})]}),(0,i.jsxs)("div",{className:"m-2",children:[(0,i.jsx)("label",{className:"mb-2 block",children:"座標位置"}),(0,i.jsx)(l.gN,{name:"coordinate",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,i.jsx)(d.Z,{className:"block w-full text-sm",value:t,onChange:a,placeholder:"請輸入古蹟座標位置(google map中右鍵可複製)"})}})]}),(0,i.jsxs)("div",{className:"m-2",children:[(0,i.jsx)("label",{className:"mb-2 block",children:"古蹟地址"}),(0,i.jsx)(l.gN,{name:"address",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,i.jsx)(d.Z,{className:"block w-full text-sm",value:t,onChange:a})}})]}),(0,i.jsxs)("div",{className:"m-2",children:[(0,i.jsx)("label",{className:"mb-2 block",children:"古蹟描述"}),(0,i.jsx)(l.gN,{name:"description",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,i.jsx)(I.Z,{className:"block w-full text-sm",value:t,onChange:a})}})]}),(0,i.jsxs)("div",{className:"m-2",children:[(0,i.jsx)("label",{className:"mb-2 block",children:"新增圖片"}),(0,i.jsx)(Z.F2,{name:"imageList",render:e=>{let{fields:t}=e;return t.map(e=>(0,i.jsx)(l.gN,{name:e,render:e=>{let{input:{value:t,onChange:a}}=e;return(0,i.jsx)(M.Z,{accept:"image/*",fileType:P.p.IMAGE,value:t,onChange:a})}},e))}})]}),(0,i.jsxs)("div",{className:"m-2",children:[(0,i.jsx)("label",{className:"mb-2 block",children:"新增影片"}),(0,i.jsx)(Z.F2,{name:"videoList",render:e=>{let{fields:t}=e;return t.map(e=>(0,i.jsx)(l.gN,{name:e,render:e=>{let{input:{value:t,onChange:a}}=e;return(0,i.jsx)(M.Z,{accept:"video/*",fileType:P.p.VIDEO,value:t,onChange:a})}},e))}})]}),(0,i.jsxs)("div",{className:"m-2",children:[(0,i.jsx)("label",{className:"mb-2 block",children:"環景照片"}),(0,i.jsx)(Z.F2,{name:"rotationList",render:e=>{let{fields:t}=e;return t.map(e=>(0,i.jsx)(l.gN,{name:e,render:e=>{let{input:{value:t,onChange:a}}=e;return(0,i.jsx)(M.Z,{accept:"image/*",fileType:P.p.PANORAMA,value:t,onChange:a})}},e))}})]})]})}})})})});H.displayName="FormModal";var O=a(7454);async function z(e){console.log(e);try{let e=await j({pageNum:1,pageSize:20});if((null==e?void 0:e.code)!==g.mI)return[];return e.data}catch(e){return[]}}let B=(0,c.memo)(()=>{let{run:e,refresh:t,data:a,loading:n}=(0,s.Q)(z,{manual:!1}),{openModal:r,formModalProps:p}=function(){let[e,t]=(0,c.useState)({open:!1}),a=(0,c.useCallback)(e=>{t({id:e,open:!0})},[]),n=(0,c.useCallback)(()=>{t({open:!1})},[]);return(0,c.useMemo)(()=>({openModal:a,formModalProps:{...e,onClose:n}}),[a,e,n])}(),g=(0,c.useMemo)(()=>[{title:"ID",dataIndex:"id"},{title:"古蹟名稱",dataIndex:"caseName"},{title:"座標位置",render:(e,t)=>"".concat(t.locationX,", ").concat(t.locationY)},{title:"古蹟地址",dataIndex:"address"},{title:"古蹟描述",dataIndex:"description"},{title:"封面照",dataIndex:"coverImgUrl",render:e=>(0,i.jsx)(O.Z,{className:"h-24 w-24 min-w-24 object-cover",src:e,width:100,height:100,alt:"封面照"})},{title:"操作者",dataIndex:"operator"},{title:"操作時間",dataIndex:"operatorTime"},{title:"操作",render:(e,a)=>(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(m.Z,{looks:u.L.green,onClick:()=>{r(a.id)},children:"編輯"}),(0,i.jsx)(m.Z,{looks:u.L.danger,onClick:()=>{T.Z.confirm({content:(0,i.jsx)("p",{children:"是否確認刪除？"}),onOk:async()=>{await y(a.id),t()},okButtonProps:{looks:u.L.danger}})},children:"刪除"})]})}],[r,t]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(l.l0,{onSubmit:e,render:e=>{let{handleSubmit:t}=e;return(0,i.jsx)("form",{onSubmit:t,children:(0,i.jsx)(l.gN,{name:"idOrName",render:e=>{let{input:{value:t,onChange:a}}=e;return(0,i.jsx)(d.Z,{value:t,onChange:a,placeholder:"請輸入古蹟名稱或ID"})}})})}}),(0,i.jsx)(m.Z,{looks:u.L.dark,onClick:()=>{r()},children:"新增古蹟"})]}),(0,i.jsx)(o.Z,{className:"mt-6",columns:g,dataSource:a,loading:n}),(0,i.jsx)(H,{...p,afterAdd:e,afterEdit:t})]})});B.displayName="LandMarkPage";var _=B}},function(e){e.O(0,[550,720,656,264,253,488,744],function(){return e(e.s=7270)}),_N_E=e.O()}]);